<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ===================================================================
         VUE FORMULAIRE - DEMANDE DE WORKFLOW
         Formulaire d√©taill√© inspir√© du mockup bancaire avec tabs
         ================================================================ -->
    
    <record id="view_workflow_request_form" model="ir.ui.view">
        <field name="name">workflow.request.form</field>
        <field name="model">workflow.request</field>
        <field name="arch" type="xml">
            <form string="Demande de Workflow" class="o_workflow_request_form">
                <!-- En-t√™te avec statusbar -->
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,submitted,in_progress,approved,rejected"/>
                </header>
                
                <sheet>
                    <!-- En-t√™te de la demande -->
                    <div class="oe_title">
                        <label for="subject" class="oe_edit_only"/>
                        <h1>
                            <field name="subject" placeholder="Titre de la demande" class="o_text_overflow"/>
                        </h1>
                        <div class="o_row">
                            <field name="name" readonly="1" class="text-muted"/>
                            <span class="text-muted"> ‚Ä¢ Cr√©√© le </span>
                            <field name="create_date" readonly="1" class="text-muted"/>
                            <span class="text-muted"> par </span>
                            <field name="requester_id" readonly="1" class="text-muted"/>
                        </div>
                    </div>
                    
                    <field name="currency_id" invisible="1"/>
                    <field name="active" invisible="1"/>
                    
                    <notebook>
                        <!-- TAB 1: INFORMATIONS -->
                        <page string="üìÑ Informations" name="info">
                            <!-- Informations g√©n√©rales -->
                            <group string="Informations g√©n√©rales">
                                <group>
                                    <field name="workflow_type_id" string="Type de workflow"/>
                                    <field name="workflow_definition_id" string="Circuit s√©lectionn√©"/>
                                </group>
                                <group>
                                    <field name="priority" widget="priority"/>
                                    <field name="state" invisible="1"/>
                                </group>
                            </group>
                            
                            <!-- Informations client -->
                            <group string="üë§ Informations client">
                                <group>
                                    <field name="client_number" placeholder="ex. CLT-2026-00784"/>
                                    <field name="account_number" placeholder="ex. 001-78459632-01"/>
                                </group>
                                <group>
                                    <field name="client_name" placeholder="Nom complet"/>
                                    <field name="credit_type"/>
                                </group>
                            </group>
                            
                            <!-- D√©tails du cr√©dit -->
                            <group string="üí∞ D√©tails du cr√©dit">
                                <group>
                                    <field name="amount" widget="monetary" options="{'currency_field': 'currency_id'}" class="o_workflow_amount"/>
                                    <field name="duration_months" string="Dur√©e (mois)"/>
                                </group>
                                <group>
                                    <field name="create_uid" string="Cr√©√© par" readonly="1"/>
                                    <field name="write_date" string="Derni√®re modification" readonly="1"/>
                                </group>
                            </group>
                            
                            <!-- Description -->
                            <group string="üìù Objet du cr√©dit" col="1">
                                <field name="description" placeholder="D√©crivez le contexte et la justification de cette demande de cr√©dit..." nolabel="1" widget="text" options="{'rows': 6}"/>
                            </group>
                        </page>
                        
                        <!-- TAB 2: CIRCUIT DE VALIDATION -->
                        <page string="üîÑ Circuit de validation" name="circuit">
                            <div class="alert alert-info" role="alert">
                                <strong>Circuit de validation :</strong> Cette section affichera la timeline de validation lorsque le module de workflow sera compl√®tement configur√©.
                            </div>
                            <group string="Configuration du circuit">
                                <group>
                                    <field name="workflow_definition_id" string="Circuit assign√©"/>
                                    <field name="state" string="Statut actuel"/>
                                </group>
                                <group>
                                    <field name="current_level_name" string="Niveau actuel" readonly="1"/>
                                </group>
                            </group>
                            
                            <separator string="Niveaux de validation configur√©s"/>
                            <div class="text-muted">
                                La timeline de validation visuelle sera affich√©e ici une fois que les niveaux d'approbation seront configur√©s.
                            </div>
                        </page>
                        
                        <!-- TAB 3: DOCUMENTS -->
                        <page string="üìé Documents" name="documents">
                            <group>
                                <field name="attachment_count" string="Nombre de documents"/>
                            </group>
                            <field name="attachment_ids" widget="many2many_binary" string="Pi√®ces jointes" nolabel="1"/>
                        </page>
                        
                        <!-- TAB 4: HISTORIQUE -->
                        <page string="üí¨ Historique" name="history">
                            <div class="alert alert-info" role="alert">
                                <strong>Historique des √©changes</strong> : Le fil de discussion et les commentaires des approbateurs appara√Ætront ici.
                            </div>
                            <!-- Le chatter standard d'Odoo sera utilis√© -->
                            <field name="message_ids" widget="mail_thread" options="{'thread_level': 1}"/>
                        </page>
                        
                        <!-- TAB 5: AUDIT -->
                        <page string="üìú Audit" name="audit" groups="base.group_system">
                            <group string="Informations de tra√ßabilit√©">
                                <group>
                                    <field name="create_uid" string="Cr√©√© par" readonly="1"/>
                                    <field name="create_date" string="Date de cr√©ation" readonly="1"/>
                                </group>
                                <group>
                                    <field name="write_uid" string="Modifi√© par" readonly="1"/>
                                    <field name="write_date" string="Derni√®re modification" readonly="1"/>
                                </group>
                            </group>
                            
                            <separator string="Logs de modification"/>
                            <div class="text-muted">
                                Les logs d√©taill√©s d'audit seront disponibles via le module d'audit Odoo.
                            </div>
                        </page>
                    </notebook>
                </sheet>
                
                <!-- Chatter pour les discussions -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- ===================================================================
         VUE LISTE (TREE) - DEMANDES DE WORKFLOW
         Interface principale inspir√©e du mockup bancaire professionnel
         ================================================================ -->
    
    <record id="view_workflow_request_tree" model="ir.ui.view">
        <field name="name">workflow.request.tree</field>
        <field name="model">workflow.request</field>
        <field name="arch" type="xml">
            <tree string="Demandes de Workflow" 
                  class="o_workflow_request_tree"
                  decoration-muted="state == 'draft'"
                  decoration-info="state == 'submitted'"
                  decoration-warning="state == 'in_progress'"
                  decoration-success="state == 'approved'"
                  decoration-danger="state == 'rejected'"
                  create="1"
                  edit="0"
                  sample="1">
                
                <!-- R√©f√©rence de la demande -->
                <field name="name" 
                       string="R√©f√©rence" 
                       widget="char"
                       decoration-bf="1"
                       optional="show"/>
                
                <!-- Titre / Objet de la demande -->
                <field name="subject" 
                       string="Titre"
                       optional="show"/>
                
                <!-- Nom du client demandeur -->
                <field name="client_name" 
                       string="Demandeur"
                       optional="show"/>
                
                <!-- Montant demand√© -->
                <field name="amount" 
                       string="Montant"
                       widget="monetary"
                       options="{'currency_field': 'currency_id'}"
                       decoration-bf="1"
                       optional="show"/>
                <field name="currency_id" invisible="1"/>
                
                <!-- Circuit de validation -->
                <field name="workflow_definition_id" 
                       string="Circuit"
                       optional="show"/>
                
                <!-- Niveau actuel -->
                <field name="current_level_name" 
                       string="Niveau actuel"
                       optional="show"/>
                
                <!-- Statut avec badge color√© -->
                <field name="state" 
                       string="Statut"
                       widget="badge"
                       decoration-info="state == 'draft'"
                       decoration-primary="state == 'submitted'"
                       decoration-warning="state == 'in_progress'"
                       decoration-success="state == 'approved'"
                       decoration-danger="state in ('rejected', 'cancelled')"
                       optional="show"/>
                
                <!-- Date de cr√©ation -->
                <field name="create_date" 
                       string="Date cr√©ation"
                       widget="datetime"
                       optional="show"/>
                
                <!-- Champs cach√©s mais disponibles -->
                <field name="workflow_type_id" optional="hide"/>
                <field name="requester_id" optional="hide"/>
                <field name="description" optional="hide"/>
                <field name="active" invisible="1"/>
                
            </tree>
        </field>
    </record>

    <!-- ===================================================================
         VUE RECHERCHE - DEMANDES DE WORKFLOW
         Filtres et groupements pour faciliter la navigation
         ================================================================ -->
    
    <record id="view_workflow_request_search" model="ir.ui.view">
        <field name="name">workflow.request.search</field>
        <field name="model">workflow.request</field>
        <field name="arch" type="xml">
            <search string="Rechercher des demandes">
                
                <!-- Barre de recherche -->
                <field name="name" string="R√©f√©rence" filter_domain="[('name', 'ilike', self)]"/>
                <field name="description" string="Description" filter_domain="[('description', 'ilike', self)]"/>
                <field name="requester_id" string="Demandeur"/>
                <field name="workflow_type_id" string="Type"/>
                <field name="workflow_definition_id" string="Circuit"/>
                
                <!-- S√©parateur -->
                <separator/>
                
                <!-- Filtres pr√©d√©finis -->
                <filter string="En cours" 
                        name="filter_pending" 
                        domain="[('state', 'in', ['submitted', 'in_progress'])]"/>
                
                <filter string="Mes demandes" 
                        name="my_requests" 
                        domain="[('requester_id', '=', uid)]"/>
                
                <separator/>
                
                <!-- Filtres par statut -->
                <filter string="Brouillon" 
                        name="filter_draft" 
                        domain="[('state', '=', 'draft')]"/>
                
                <filter string="Soumis" 
                        name="filter_submitted" 
                        domain="[('state', '=', 'submitted')]"/>
                
                <filter string="Approuv√©" 
                        name="filter_approved" 
                        domain="[('state', '=', 'approved')]"/>
                
                <filter string="Refus√©" 
                        name="filter_refused" 
                        domain="[('state', '=', 'rejected')]"/>
                
                <filter string="Annul√©" 
                        name="filter_cancelled" 
                        domain="[('state', '=', 'cancelled')]"/>
                
                <separator/>
                
                <!-- Filtres temporels -->
                <filter string="Cette semaine" 
                        name="filter_this_week"
                        domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                
                <filter string="Ce mois" 
                        name="filter_this_month"
                        domain="[('create_date', '&gt;=', (context_today().replace(day=1)).strftime('%Y-%m-%d'))]"/>
                
                <!-- Groupements -->
                <group expand="0" string="Grouper par">
                    <filter string="Statut" name="group_status" context="{'group_by': 'state'}"/>
                    <filter string="Type de workflow" name="group_type" context="{'group_by': 'workflow_type_id'}"/>
                    <filter string="Circuit" name="group_definition" context="{'group_by': 'workflow_definition_id'}"/>
                    <filter string="Demandeur" name="group_requester" context="{'group_by': 'requester_id'}"/>
                </group>
                
            </search>
        </field>
    </record>

    <!-- ===================================================================
         ACTION FEN√äTRE - DEMANDES DE WORKFLOW
         ================================================================ -->
    
    <record id="action_workflow_request" model="ir.actions.act_window">
        <field name="name">Demandes de Workflow</field>
        <field name="res_model">workflow.request</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{
            'search_default_my_requests': 1,
            'search_default_filter_pending': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Cr√©er votre premi√®re demande de workflow
            </p>
            <p>
                Le syst√®me de workflow vous permet de g√©rer vos processus de validation multi-niveaux.<br/>
                Cliquez sur "Cr√©er" pour soumettre une nouvelle demande.
            </p>
        </field>
    </record>

    <!-- ===================================================================
         MENU PRINCIPAL - WORKFLOW
         ================================================================ -->
    
    <menuitem id="menu_workflow_root"
              name="Workflow"
              sequence="10"/>
    
    <menuitem id="menu_workflow_requests"
              name="Demandes"
              parent="menu_workflow_root"
              sequence="10"/>
    
    <menuitem id="menu_workflow_request_all"
              name="Toutes les demandes"
              parent="menu_workflow_requests"
              action="action_workflow_request"
              sequence="10"/>

</odoo>
